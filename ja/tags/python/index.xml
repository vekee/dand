<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Python on DUAN DAHAI</title><link>https://www.duandahai.com/ja/tags/python/</link><description>Recent content in Python on DUAN DAHAI</description><generator>Hugo -- gohugo.io</generator><language>en</language><lastBuildDate>Sat, 14 Jan 2023 00:00:00 +0000</lastBuildDate><atom:link href="https://www.duandahai.com/ja/tags/python/index.xml" rel="self" type="application/rss+xml"/><item><title>バイナリコードの文字列変数をデコードする</title><link>https://www.duandahai.com/ja/posts/jp/20230114-python-binary-decode.ja/</link><pubDate>Sat, 14 Jan 2023 00:00:00 +0000</pubDate><guid>https://www.duandahai.com/ja/posts/jp/20230114-python-binary-decode.ja/</guid><description>Pythonでバイナリデータをデコードする方法は、以下のものがあるが、 今回の課題はバイナリデータではなく、バイナリデータの文字列をデコードすることです。
1 2 3 4 5 # エンコード（文字列の&amp;#34;日本&amp;#34;をbytesに変換） print(&amp;#34;日本&amp;#34;.encode(&amp;#34;utf-8&amp;#34;)) # デコード（bytesを文字列の&amp;#34;日本&amp;#34;に変換） print(b&amp;#39;\xe6\x97\xa5\xe6\x9c\xac&amp;#39;.decode(&amp;#34;utf-8&amp;#34;)) なぜこの変な課題があるかは、AWS S3 Triggerで起きたイベントに、日本語名KeyがUTF-8でエンコードされて、以下のように出ています。
1 2 3 4 5 # S3 Trigger設定された元のS3 Key名 &amp;#34;日本/test.pdf&amp;#34; # S3 Triggerで起きたイベントに出ているKey名 &amp;#34;%e6%97%a5%e6%9c%ac/test.pdf&amp;#34; デコード方法 バイナリデータの文字列は、文字列型の変数のため、直接bytes関数よりデコードができません。
また、この変数をさらにエンコードしてから、デコードしてもできません。 以下の結果になります。
1 2 3 bstr = &amp;#34;\xe6\x97\xa5\xe6\x9c\xac&amp;#34; print(bstr.encode(&amp;#34;utf-8&amp;#34;).decode(&amp;#34;utf-8&amp;#34;)) # output：\\xe6\\x97\\xa5\\xe6\\x9c\\xac Pythonのbytes仕様を調べたら、fromhex関数があるため、 16進数の文字を以下のようにデコードができます。
1 2 3 bstr = &amp;#34; e6 97 a5 e6 9c ac&amp;#34; print(bytes.fromhex(bstr)) # output：&amp;#34;日本&amp;#34; 上記の方法を従って、S3 Triggerで起きたイベントに出ているKey名に、 16進数の文字を判別して、fromhexでデコードできる発想がありました。
デコード例： &amp;ldquo;%e6%97%a5%e6%9c%ac/test.pdf&amp;quot;から、&amp;quot;%e6%97%a5%e6%9c%ac&amp;quot;を16進数として判別し、&amp;rdquo; e6 97 a5 e6 9c ac&amp;quot;に変換してからfromhexでデコードします。</description></item><item><title>Pythonでファイルを圧縮する際のファイル名文字化け対策</title><link>https://www.duandahai.com/ja/posts/jp/20230111-python-zip.ja/</link><pubDate>Wed, 11 Jan 2023 00:00:00 +0000</pubDate><guid>https://www.duandahai.com/ja/posts/jp/20230111-python-zip.ja/</guid><description>Pythonでファイルを圧縮する際のファイル名文字化け対策をご紹介します。
日本語名のファイルに対して、Pythonでパスワード付き圧縮を実施する場合、ファイル名の文字化けが発生しました。
この問題はライブラリー内部仕様のため、ライブラリーを改造しないと解決できないそうですが、外部圧縮ツールをPython実装に利用して、強力、簡単的に圧縮できることを見つかりました。
外部圧縮ツール 私がAWS LambdaのPythonスクリプトに、7-zipのコマンドラインコマンドでzip処理を実施しています。 利用している7-zipツールの7zzsは以下のページからダウンロードしました。
7zipのコマンドライン
Windows環境にコマンドラインの利用はもちろんできます。
利用方法 私が7zzsをS3の指定場所に保存し、zip処理で、s3からLambdaの/tmp配下にダウンロードして利用しています。
この場合、7zzsの実行権限を設定する必要があるので、以下の実装をご参照ください。
Python実装 1 2 3 4 5 6 7 8 # zipツールのダウンロード実装略 # zipツールの実行権限を付与 cmd = f&amp;#34;chmod 755 /tmp/7zzs&amp;#34; os.system(cmd) # パスワード付きzipツールを実行する(パスワード: 123456) cmd = &amp;#34;/tmp/7zzs a 日本語名ファイル.zip 日本語名ファイル.pdf -p 123456&amp;#34; os.system(cmd) 7-zipのコマンドラインの利用紹介は、公開しているホームページにご参照ください。</description></item></channel></rss>